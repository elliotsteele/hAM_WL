#!/bin/sh

# Example of calculating a vulnerability window in 1D tissue models

# You can use any 1D tissue model to calculate the vulnerability window for conduction block at 
# different S2 locations and coupling intervals. We’ll use the model “Vent_transmural” which has 
# celltypes EPI, M and ENDO evenly spaced. In this example, we’ll just consider a couple of S2 
# locations and a coarse coupling interval, but you could cycle through S2 locations at any 
# interval to provide a picture over the whole tissue.
# You should also pre-pace the model to stable state at the desired BCL and write the state file 
# to read in for the vulnerability window calculations for actual investigation. 

for i in 25 75
do
    S2_loc=$(printf "%0d" $i)
    for j in `seq 200 -5 150`
    do
        S2=$(printf "%0d" $j)
        ./model_tissue_native Tissue_model Vent_transmural Tissue_order 1D Beats 1  S2 ${S2} S2_x_loc ${S2_loc} Reference Vulnerability_window Results_Reference location_${S2_loc}_S2_${S2}
    done 
done

# And now the file “Outputs_tissue_native_Vulnerability_window/1D_conduction_success_log.dat” 
# contains a list of the S2 locations (column 1), coupling intervals (column 2), conduction 
# success at either edge of the tissue (columns 3 and 4, where 0 = failure and 1 = success) 
# and the conduction type (column 5, where 0 = failure, 1 = unidirectional conduction and 
# 2 = full conduction). The raw data can be inspected using 
# “Outputs_tissue_native_Vulnerability_window /Results_location_x_S2_y/Vm_linescan.dat.” 
# For a quick inspection (rather than plotting the full colour-map linescan in 2D), you can 
# simply plot columns 10 and 90, representing the voltage in cells 10 and 90 with the x-axis 
# intervals representing the 1 ms increments of linescan output. 

# In this example, we can see that for the location at x = 25, the S2 interval 155 resulted 
# in uni-directional conduction and for x = 75 it occurred for 185 and 180. We could then cycle 
# within those coupling intervals in 1 ms increments to determine the full vulnerability window 
# to an accuracy of 1ms. 

#S2_loc=$(printf "%0d" 25)
#for j in `seq 159 -1 151`
#do
#        S2=$(printf "%0d" $j)
#        ./model_tissue_native Tissue_model Vent_transmural Tissue_order 1D Beats 1  S2 ${S2} S2_x_loc ${S2_loc} Reference Vulnerability_window Results_Reference location_${S2_loc}_S2_${S2}
#done

#S2_loc=$(printf "%0d" 75)
#for j in `seq 189 -1 176`
#do
#        S2=$(printf "%0d" $j)
#        ./model_tissue_native Tissue_model Vent_transmural Tissue_order 1D Beats 1  S2 ${S2} S2_x_loc ${S2_loc} Reference Vulnerability_window Results_Reference location_${S2_loc}_S2_${S2}
#done

# Check "BASIC_INSTRUCTIONS_USE.txt" and Full_documentation.pdf for output file contents


